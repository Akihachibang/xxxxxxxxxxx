local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- ตั้งค่าระยะห่างจากบอล (ปรับค่าได้ตามต้องการ)
local DISTANCE_UNDER_BALL = 7  -- อยู่ใต้บอล 8 หน่วย (เพิ่มจากเดิม 5 หน่วย)

-- ระบบรอผู้เล่น
local Player = Players.LocalPlayer
while not Player do
    Players.PlayerAdded:Wait()
    Player = Players.LocalPlayer
end

-- ระบบติดตามบอล
local function trackBall()
    local ballsFolder = workspace:WaitForChild("Balls")
    local currentBall = ballsFolder:FindFirstChild("Ball")
    
    while not currentBall do
        ballsFolder.ChildAdded:Wait()
        currentBall = ballsFolder:FindFirstChild("Ball")
    end
    
    return currentBall
end

local Ball = trackBall()

-- ระบบลอยตัวหลัก
local floatSystem = {
    Active = true,
    Connections = {},
    Settings = {
        FloatingSpeed = 1,    -- ความเร็วการลอย (ปรับได้)
        MinDistance = DISTANCE_UNDER_BALL,  -- ระยะต่ำสุดใต้บอล
        MaxDistance = DISTANCE_UNDER_BALL + 2  -- ระยะสูงสุดใต้บอล (ให้มีการลอยขึ้นลงเล็กน้อย)
    }
}

-- ฟังก์ชันลอยใต้บอล
local function floatUnderBall()
    if not Player.Character then return end
    
    local humanoidRootPart = Player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    -- หาตำแหน่งบอล
    local ballPart = Ball:IsA("Model") and (Ball.PrimaryPart or Ball:FindFirstChildWhichIsA("BasePart")) or Ball
    if not ballPart then return end
    
    -- คำนวณตำแหน่งใต้บอล + การลอยขึ้นลงเล็กน้อยแบบธรรมชาติ
    local timeOffset = math.sin(tick() * floatSystem.Settings.FloatingSpeed) * 0.5
    local targetOffset = floatSystem.Settings.MinDistance + timeOffset
    
    -- ตั้งค่าตำแหน่งใหม่
    humanoidRootPart.CFrame = CFrame.new(
        ballPart.Position + Vector3.new(0, -targetOffset, 0),
        ballPart.Position
    )
    
    -- จำลองการกดปุ่ม F
    if tick() % 0.1 < 0.02 then  -- กด F 5 ครั้งต่อวินาที
        local pressFEvent = ReplicatedStorage:FindFirstChild("PressFEvent")
        if pressFEvent then
            pressFEvent:FireServer()
        end
    end
end

-- ระบบลอยอัตโนมัติ
local function startFloatingSystem()
    floatSystem.Connections["Heartbeat"] = RunService.Heartbeat:Connect(function()
        if floatSystem.Active then
            floatUnderBall()
        end
    end)
end

-- ระบบติดตามการเปลี่ยนแปลงบอล
local function trackBallChanges()
    floatSystem.Connections["BallAdded"] = workspace.Balls.ChildAdded:Connect(function(child)
        if child.Name == "Ball" then
            Ball = child
        end
    end)
    
    floatSystem.Connections["BallRemoved"] = Ball.AncestryChanged:Connect(function(_, parent)
        if not parent then
            Ball = trackBall()
        end
    end)
end

-- เริ่มต้นระบบ
startFloatingSystem()
trackBallChanges()

-- ทำความสะอาดเมื่อเกมปิด
game:BindToClose(function()
    floatSystem.Active = false
    for _, conn in pairs(floatSystem.Connections) do
        conn:Disconnect()
    end
end)
